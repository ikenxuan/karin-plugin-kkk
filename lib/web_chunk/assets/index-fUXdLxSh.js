import{c as _,S as I,g as $,h as R,r as l}from"./request-Dm7ETs-V.js";import{j as M,r as k}from"./index-D0n4Qn5t.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],H=_("video",D);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ee=_("x",A),j=R("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function te({className:e,variant:a,asChild:t=!1,...i}){const r=t?I:"span";return M.jsx(r,{"data-slot":"badge",className:$(j({variant:a}),e),...i})}const w=768,ae=()=>{const[e,a]=k.useState(void 0);return k.useEffect(()=>{const t=window.matchMedia(`(max-width: ${w-1}px)`),i=()=>{a(window.innerWidth<w)};return t.addEventListener("change",i),a(window.innerWidth<w),()=>t.removeEventListener("change",i)},[]),!!e},p=e=>{if(e<0)return"0:00";const a=Math.floor(e),t=Math.floor(a/60),i=a%60;if(t>=60){const r=Math.floor(t/60),o=t%60;return`${r}:${o.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}return`${t}:${i.toString().padStart(2,"0")}`},u=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e>=1e3?(e/1e3).toFixed(1)+"k":e.toString(),f=e=>{const t=Math.floor(Date.now()/1e3)-e;return t<60?"刚刚":t<3600?`${Math.floor(t/60)}分钟前`:t<86400?`${Math.floor(t/3600)}小时前`:t<2592e3?`${Math.floor(t/86400)}天前`:new Date(e*1e3).toLocaleDateString("zh-CN")},Y=e=>{const a=[/https?:\/\/(?:[^\s]*\.)?(?:douyin\.com|iesdouyin\.com|webcast\.amemv\.com|live\.douyin\.com)(?:\/[^\s\u4e00-\u9fff]*)*/gi,/(https?:\/\/(?:www\.bilibili\.com|m\.bilibili\.com|t\.bilibili\.com|b23\.tv|bili2233\.cn)\/[a-zA-Z0-9_\-.~:\\/?#[\]@!$&'()*+,;=]+)/gi,/https?:\/\/(?:[^\s]*\.)?(?:kuaishou\.com|kwai\.com|chenzhongtech\.com)(?:\/[^\s\u4e00-\u9fff]*)*/gi];for(const r of a){const o=e.match(r);if(o&&o.length>0){let s=o[0];return s=s.replace(/[，。！？；：、"'`]+$/,""),s}}const t=/https?:\/\/[^\s\u4e00-\u9fff]+/gi,i=e.match(t);if(i&&i.length>0){let r=i[0];return r=r.replace(/[，。！？；：、"'`]+$/,""),r}return null},N=e=>{const a=e.match(/\/video\/(BV[a-zA-Z0-9]+)/),t=e.match(/\/video\/av(\d+)/),i=e.match(/^https:\/\/t\.bilibili\.com\/(\d+)/),r=e.match(/^https:\/\/www\.bilibili\.com\/opus\/(\d+)/);let o=null,s="";switch(a?(o=a,s="bvid"):t?(o=t,s="aid"):i?(o=i,s="dynamic"):r&&(o=r,s="dynamic"),s){case"bvid":return{platform:"bilibili",workId:o?.[1]??"",workType:"video",params:{bvid:o?.[1]??""}};case"aid":return{platform:"bilibili",workId:o?.[1]??"",workType:"video",params:{aid:o?.[1]??""}};case"dynamic":return{platform:"bilibili",workId:o?.[1]??"",workType:"dynamic_info",params:{dynamic_id:o?.[1]??""}}}throw new Error("无法从URL中提取哔哩哔哩作品ID")},C=async e=>{try{if(e.workType==="dynamic_info")return await T(e);const a=await l.post("/api/kkk/bilibili/data",{dataType:"单个视频作品数据",params:e.params}),t=await l.post("/api/kkk/bilibili/data",{dataType:"单个视频下载信息数据",params:{avid:a.data.data.data.data.aid,cid:a.data.data.data.data.cid}}),i=a.data.data.data.data,r=await l.post("/api/kkk/bilibili/data",{dataType:"评论数据",params:{oid:i.aid.toString(),type:1,number:50}}),o=await l.post("/api/kkk/bilibili/data",{dataType:"Emoji数据",params:{}}),s=r.data.data.data,n=o.data.data.data,c=b(s.data?.replies||[],n);return{id:i.bvid,title:i.title||"无标题",description:i.desc||"",thumbnail:i.pic||"",duration:p(i.duration||0),views:u(i.stat?.view||0),likes:u(i.stat?.like||0),author:i.owner?.name||"未知用户",type:"video",downloadUrl:{video:t.data.data.data.data.dash.video[0].baseUrl||"获取失败",audio:t.data.data.data.data.dash.audio[0].baseUrl||"获取失败"},images:void 0,tags:i.tname?[i.tname]:[],comments:c,commentCount:i.stat?.reply||0}}catch(a){throw new Error(`哔哩哔哩数据解析失败: ${a.message}`)}},T=async e=>{try{const a=await l.post("/api/kkk/bilibili/data",{dataType:"动态详情数据",params:{dynamic_id:e.params.dynamic_id,typeMode:"strict"}}),t=await l.post("/api/kkk/bilibili/data",{dataType:"动态卡片数据",params:{dynamic_id:a.data.data.data.data.item.id_str,typeMode:"strict"}}),i=a.data.data.data.data,r=t.data.data.data.data;let o=[],s=0;if(i.item.type!=="LIVE_RCMD")try{const m=await l.post("/api/kkk/bilibili/data",{dataType:"评论数据",params:{type:B(i.item.type),oid:L(i,r),number:50}}),g=await l.post("/api/kkk/bilibili/data",{dataType:"Emoji数据",params:{}}),h=m.data.data.data,v=g.data.data.data;o=b(h.data?.replies||[],v),s=i.item.modules?.module_stat?.comment?.count||0}catch(m){console.warn("获取动态评论失败:",m)}const n=V(i);return{id:i.item.id_str,title:n.title||`${i.item.modules.module_author.name}的动态`,description:n.description||"",thumbnail:n.thumbnail||i.item.modules.module_author.face,duration:"0:00",views:u(i.item.modules?.module_stat?.view?.count||0),likes:u(i.item.modules?.module_stat?.like?.count||0),author:i.item.modules.module_author.name||"未知用户",type:n.type,downloadUrl:void 0,images:n.images,tags:[],comments:o,commentCount:s}}catch(a){throw new Error(`哔哩哔哩动态解析失败: ${a.message}`)}},V=e=>{const a=e.item;switch(a.type){case"DYNAMIC_TYPE_DRAW":return{title:"图文动态",description:a.modules.module_dynamic?.desc?.text||"",thumbnail:a.modules.module_dynamic?.major?.draw?.items?.[0]?.src||"",images:a.modules.module_dynamic?.major?.draw?.items?.map(i=>i.src)||[],type:"note"};case"DYNAMIC_TYPE_WORD":return{title:"文字动态",description:a.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"};case"DYNAMIC_TYPE_AV":return{title:a.modules.module_dynamic?.major?.archive?.title||"视频动态",description:a.modules.module_dynamic?.major?.archive?.desc||"",thumbnail:a.modules.module_dynamic?.major?.archive?.cover||"",images:[],type:"video"};case"DYNAMIC_TYPE_FORWARD":return{title:"转发动态",description:a.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"};default:return{title:"动态内容",description:a.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"}}},B=e=>{switch(e){case"DYNAMIC_TYPE_AV":return 1;case"DYNAMIC_TYPE_DRAW":case"DYNAMIC_TYPE_WORD":case"DYNAMIC_TYPE_FORWARD":return 17;default:return 17}},L=(e,a)=>{const t=e.item;switch(t.type){case"DYNAMIC_TYPE_AV":return t.modules.module_dynamic?.major?.archive?.aid?.toString()||t.id_str;case"DYNAMIC_TYPE_WORD":case"DYNAMIC_TYPE_FORWARD":return t.id_str;default:return a.card.desc.rid.toString()}},b=(e,a)=>!e||!Array.isArray(e)?[]:e.map((t,i)=>{let r=t.content?.message||"";return a&&r&&(r=W(r,a)),{id:t.rpid?.toString()||i.toString(),author:t.member?.uname||"匿名用户",avatar:t.member?.avatar||"",content:r,images:t.content?.pictures?t.content.pictures.map(o=>o.img_src):[],likes:t.like||0,timestamp:f(t.ctime||0)}}),W=(e,a)=>{if(!e||!a?.data?.packages)return e;let t=e;const i=new Map;a.data.packages.forEach(n=>{n.emote.forEach(c=>{i.set(c.text,c.url)})});const r=/\[([^\]]+)\]/g;return t=t.replace(r,(n,c)=>{const m=i.get(n)||i.get(c);return m?`<img src="${m}" alt="${c}" class="emoji" />`:n}),t.split(/(<img[^>]*>)/).map(n=>n.startsWith("<img")?n:n.trim()?`<span>${n}</span>`:n).join("")},O=e=>{const a=/video\/(\d+)/.exec(e),t=/note\/(\d+)/.exec(e),i=/modal_id=(\d+)/.exec(e);switch(!0){case/video\/(\d+)/.test(e):return{platform:"douyin",workId:a?a[1]:"",workType:"video",params:{aweme_id:a?a[1]:""}};case/note\/(\d+)/.test(e):return{platform:"douyin",workId:t?t[1]:"",workType:"video",params:{aweme_id:t?t[1]:""}};case/modal_id=(\d+)/.test(e):return{platform:"douyin",workId:i?i[1]:"",workType:"video",params:{aweme_id:i?i[1]:""}};default:throw new Error("无法从URL中提取抖音作品ID")}},U=(e,a)=>{if(!a||a.length===0)return e;let t=e;return a.forEach(i=>{if(i){const r=new RegExp(`#${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?:\\s|$)`,"gi");t=t.replace(r,"");const o=new RegExp(`@${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?:\\s|$)`,"gi");t=t.replace(o,"");const s=new RegExp(`\\b${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");t=t.replace(s,"")}}),t.replace(/\s+/g," ").trim()},F=async e=>{try{const a=await l.post("/api/kkk/douyin/data",{dataType:"聚合解析",params:e.params}),t=await l.post("/api/kkk/douyin/data",{dataType:"评论数据",params:e.params}),i=await l.post("/api/kkk/douyin/data",{dataType:"Emoji数据",params:{}}),r=a.data.data.data.aweme_detail,o=t.data.data.data,s=i.data.data.data,n=r.is_slides===!0&&r.images!==null,c=!r.images&&!n,m=n?"slides":c?"video":"note",g=K(o.comments,s),h=Array.isArray(r.text_extra)?r.text_extra.map(d=>typeof d=="string"?d:d.hashtag_name).filter(Boolean):[],v=r.desc||"无标题",E=U(v,h);let y;return n&&r.images&&(y=r.images.map(d=>d.clip_type===2?{type:"image",url:d.url_list[2],thumbnail:d.url_list[2]}:d.clip_type===3?{type:"livephoto",url:d.url_list[2],videoUrl:d.video.play_addr_h264.url_list[0],thumbnail:d.url_list[2],duration:p(d.video?.duration/1e3||0)}:{type:"video",url:d.video.play_addr_h264.url_list[0],thumbnail:d.url_list[2],duration:p(d.video?.duration/1e3||0)})),{id:`${r.aweme_id}_${Date.now()}`,title:E,description:r.desc||"",thumbnail:c?r.video?.cover?.url_list?.[0]:r.images?.[0]?.url_list?.[0]||"",duration:c?p(r.video?.duration/1e3||0):"0:00",views:u(r.statistics?.play_count||0),likes:u(r.statistics?.digg_count||0),author:r.author?.nickname||"未知用户",type:m,downloadUrl:{video:c?r.video?.play_addr?.url_list?.[0]||"获取失败":n&&y&&y.find(d=>d.type==="video")?.url||void 0,audio:n&&r.video?r.video?.play_addr?.url_list?.[0]||"获取失败":r.music?.play_url?.uri||"获取失败"},images:m==="note"?r.images?.map(d=>d.url_list?.[2]).filter(Boolean):void 0,slides:y,tags:h,comments:g,commentCount:r.statistics?.comment_count||0}}catch(a){throw new Error(`抖音数据解析失败: ${a.message}`)}},K=(e,a)=>!e||!Array.isArray(e)?[]:e.map((t,i)=>{let r=t.text||"";return a&&t.text&&(r=z(t.text,a)),{id:`${t.cid||i.toString()}_${Date.now()}`,author:t.user?.nickname||"匿名用户",avatar:t.user?.avatar_thumb?.url_list?.[0]||"",content:r,images:t.image_list?t.image_list.map(o=>o.origin_url?.url_list?.[3]).filter(Boolean):[],likes:t.digg_count||0,timestamp:f(t.create_time||0)}}),z=(e,a)=>{if(!e||!a?.emoji_list)return e;let t=e;const i=/\[([^\]]+)\]/g;return t=t.replace(i,(s,n)=>{const c=a.emoji_list.find(m=>m.display_name===`[${n}]`);return c&&c.emoji_url?.url_list?.[0]?`<img src="${c.emoji_url.url_list[0]}" alt="${n}" class="emoji" />`:s}),t.split(/(<img[^>]*>)/).map(s=>s.startsWith("<img")?s:s.trim()?`<span>${s}</span>`:s).join("")},P=e=>{const a=e.match(/\/short-video\/(\w+)/);if(!a)throw new Error("无法从URL中提取快手作品ID");const t=a[1];return{platform:"kuaishou",workId:t,workType:"video",params:{photoId:t}}},S=async e=>{try{const a=await l.post("/api/kkk/kuaishou/data",{dataType:"单个作品数据",params:e.params}),t=await l.post("/api/kkk/kuaishou/data",{dataType:"评论数据",params:e.params}),i=await l.post("/api/kkk/kuaishou/data",{dataType:"Emoji数据",params:{}}),r=a.data.data.photo,o=t.data.data,s=i.data.data,n=q(o.rootComments||[],s);return{id:r.photoId||e.workId,title:r.caption||"无标题",description:r.caption||"暂无描述",thumbnail:r.coverUrl||"",duration:p(r.duration||0),views:u(r.viewCount||0),likes:u(r.likeCount||0),author:r.userName||"未知用户",type:"video",downloadUrl:{video:r.mainMvUrls?.[0]?.url||"",audio:r.mainMvUrls?.[0]?.url||""},images:void 0,tags:r.tags?.map(m=>m.name).filter(Boolean)||[],comments:n.slice(0,20),commentCount:r.commentCount||0}}catch(a){throw new Error(`快手数据解析失败: ${a.message}`)}},q=(e,a)=>!e||!Array.isArray(e)?[]:e.map((t,i)=>{let r=t.content||"";return a&&t.content&&(r=Z(t.content,a)),{id:t.commentId||i.toString(),author:t.authorName||"匿名用户",avatar:t.headUrl||"",content:r,images:[],likes:t.likedCount||0,timestamp:f(t.timestamp||0)}}),Z=(e,a)=>{let t=e;return a&&a.emoji_list&&a.emoji_list.forEach(i=>{const r=new RegExp(`\\[${i.name}\\]`,"g"),o=`<img src="${i.url}" alt="${i.name}" class="emoji" />`;t=t.replace(r,o)}),t};var x=(e=>(e[e.OK=200]="OK",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.InternalServerError=500]="InternalServerError",e[e.AccessTokenExpired=419]="AccessTokenExpired",e[e.RefreshTokenExpired=420]="RefreshTokenExpired",e))(x||{});class X{async parseVideo(a){const t=Y(a);if(!t)throw new Error("未能从输入文本中提取到有效的视频链接");const i=await l.post("/api/kkk/getLongLink",{link:t});if(i.data.code!==x.OK)throw new Error(i.data.message||"链接解析失败");const{finalUrl:r,platform:o}=i.data.data;let s;switch(o){case"douyin":s=O(r);break;case"bilibili":s=N(r);break;case"kuaishou":s=P(r);break;default:throw new Error(`不支持的平台: ${o}`)}let n;switch(o){case"douyin":n=await F(s);break;case"bilibili":n=await C(s);break;case"kuaishou":n=await S(s);break;default:throw new Error(`不支持的平台: ${o}`)}return n}}const ie=new X;export{te as B,H as V,ee as X,Y as e,ae as u,ie as v};
