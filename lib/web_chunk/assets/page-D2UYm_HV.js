const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-CO0KNPJl.js","assets/index-Cu6l33VG.js","assets/index-DICd1U-F.css"])))=>i.map(i=>d[i]);
import{s as et}from"./Combination-BlTR8rnz.js";import{a as Lt,i as Rt,n as It,o as Xt,r as vt,t as Yt}from"./select-BUJnEX6X.js";import{t as At}from"./eye-OLZaDgQl.js";import{J as ct,Q,V as Ut,Z as Dt,c as zt,ct as xt,d as Ft,et as qt,f as Ht,i as nt,l as Kt,n as I,p as mt,rt as Vt,tt as Zt,u as Bt}from"./index-Cu6l33VG.js";import{t as Qt}from"./separator-Bfuy4nsm.js";import{n as Gt,s as st,t as gt}from"./request-63K6ALwk.js";var Jt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Wt=ct("arrow-right",Jt),te=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ee=ct("eye-off",te),ae=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],re=ct("lock",ae),h=xt(Vt(),1);function it(){return it=Object.assign?Object.assign.bind():function(o){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(o[r]=a[r])}return o},it.apply(this,arguments)}var U=function(i,a){return i.querySelector(a)},oe=function(i,a){return i.querySelectorAll(a)},ne=function(i){i===void 0&&(i={});var a={};return Object.keys(i).forEach(function(r){typeof i[r]<"u"&&(a[r]=i[r])}),a},se={alwaysActive:!1,activeOffset:50,shadowOffset:50,shadowScale:1,duration:300,rotate:!0,rotateTouch:!0,rotateXMax:15,rotateYMax:15,rotateXInvert:!1,rotateYInvert:!1,stretchX:0,stretchY:0,stretchZ:0,commonOrigin:!0,shadow:!0,highlight:!0};function ie(o){o===void 0&&(o={});var i=o,a=i.el,r=i.eventsEl,b=o.isComponent,w,m={__atropos__:!0,params:it({},se,{onEnter:null,onLeave:null,onRotate:null},ne(o||{})),destroyed:!1,isActive:!1},t=m.params,C,O,X,$,k,f,d,L,A,g,N=[],R;(function p(){R=requestAnimationFrame(function(){N.forEach(function(e){if(typeof e=="function")e();else{var l=e.element,v=e.prop,x=e.value;l.style[v]=x}}),N.splice(0,N.length),p()})})();var T=function(e,l){N.push({element:e,prop:"transitionDuration",value:l})},P=function(e,l){N.push({element:e,prop:"transitionTimingFunction",value:l})},j=function(e,l){N.push({element:e,prop:"transform",value:l})},s=function(e,l){N.push({element:e,prop:"opacity",value:l})},c=function(e,l){N.push({element:e,prop:"transformOrigin",value:l})},u=function(e,l,v,x){return e.addEventListener(l,v,x)},E=function(e,l,v,x){return e.removeEventListener(l,v,x)},F=function(){var e;f=U(a,".atropos-shadow"),f||(f=document.createElement("span"),f.classList.add("atropos-shadow"),e=!0),j(f,"translate3d(0,0,-"+t.shadowOffset+"px) scale("+t.shadowScale+")"),e&&C.appendChild(f)},G=function(){var e;d=U(a,".atropos-highlight"),d||(d=document.createElement("span"),d.classList.add("atropos-highlight"),e=!0),j(d,"translate3d(0,0,0)"),e&&X.appendChild(d)},q=function(e){var l=e.rotateXPercentage,v=l===void 0?0:l,x=e.rotateYPercentage,y=x===void 0?0:x,M=e.duration,z=e.opacityOnly,K=e.easeOut,V=function(S){if(S.dataset.atroposOpacity&&typeof S.dataset.atroposOpacity=="string")return S.dataset.atroposOpacity.split(";").map(function(Y){return parseFloat(Y)})};oe(w,"[data-atropos-offset], [data-atropos-opacity]").forEach(function(_){T(_,M),P(_,K?"ease-out":"");var S=V(_);if(v===0&&y===0)z||j(_,"translate3d(0, 0, 0)"),S&&s(_,S[0]);else{var Y=parseFloat(_.dataset.atroposOffset)/100;if(!Number.isNaN(Y)&&!z&&j(_,"translate3d("+-y*-Y+"%, "+v*-Y+"%, 0)"),S){var W=S[0],rt=S[1],ot=Math.max(Math.abs(v),Math.abs(y));s(_,W+(rt-W)*ot/100)}}})},H=function(e,l){var v=a!==r;if($||($=a.getBoundingClientRect()),v&&!k&&(k=r.getBoundingClientRect()),typeof e>"u"&&typeof l>"u"){var x=v?k:$;e=x.left+x.width/2,l=x.top+x.height/2}var y=0,M=0,z=$,K=z.top,V=z.left,_=z.width,S=z.height,Y;if(v){var tt=k,pt=tt.top,ht=tt.left,jt=tt.width,Ct=tt.height,Ot=V-ht,Mt=K-pt,_t=_/2+Ot,St=S/2+Mt,bt=e-ht,Tt=l-pt;M=t.rotateYMax*(bt-_t)/(jt-_/2)*-1,y=t.rotateXMax*(Tt-St)/(Ct-S/2),Y=e-V+"px "+(l-K)+"px"}else{var W=_/2,rt=S/2,ot=e-V,Nt=l-K;M=t.rotateYMax*(ot-W)/(_/2)*-1,y=t.rotateXMax*(Nt-rt)/(S/2)}y=Math.min(Math.max(-y,-t.rotateXMax),t.rotateXMax),t.rotateXInvert&&(y=-y),M=Math.min(Math.max(-M,-t.rotateYMax),t.rotateYMax),t.rotateYInvert&&(M=-M);var Z=y/t.rotateXMax*100,B=M/t.rotateYMax*100,Pt=(v?B/100*t.stretchX:0)*(t.rotateYInvert?-1:1),Et=(v?Z/100*t.stretchY:0)*(t.rotateXInvert?-1:1),kt=v?Math.max(Math.abs(Z),Math.abs(B))/100*t.stretchZ:0;j(C,"translate3d("+Pt+"%, "+-Et+"%, "+-kt+"px) rotateX("+y+"deg) rotateY("+M+"deg)"),Y&&t.commonOrigin&&c(C,Y),d&&(T(d,t.duration+"ms"),P(d,"ease-out"),j(d,"translate3d("+-B*.25+"%, "+Z*.25+"%, 0)"),s(d,Math.max(Math.abs(Z),Math.abs(B))/100)),q({rotateXPercentage:Z,rotateYPercentage:B,duration:t.duration+"ms",easeOut:!0}),typeof t.onRotate=="function"&&t.onRotate(y,M)},lt=function(){N.push(function(){return a.classList.add("atropos-active")}),T(C,t.duration+"ms"),P(C,"ease-out"),j(O,"translate3d(0,0, "+t.activeOffset+"px)"),T(O,t.duration+"ms"),P(O,"ease-out"),f&&(T(f,t.duration+"ms"),P(f,"ease-out")),m.isActive=!0},J=function(e){if(L=void 0,!(e.type==="pointerdown"&&e.pointerType==="mouse")&&!(e.type==="pointerenter"&&e.pointerType!=="mouse")){if(e.type==="pointerdown"&&e.preventDefault(),A=e.clientX,g=e.clientY,t.alwaysActive){$=void 0,k=void 0;return}lt(),typeof t.onEnter=="function"&&t.onEnter()}},ut=function(e){L===!1&&e.cancelable&&e.preventDefault()},ft=function(e){if(!(!t.rotate||!m.isActive)){if(e.pointerType!=="mouse"){if(!t.rotateTouch)return;e.preventDefault()}var l=e.clientX,v=e.clientY,x=l-A,y=v-g;if(typeof t.rotateTouch=="string"&&(x!==0||y!==0)&&typeof L>"u"){if(x*x+y*y>=25){var M=Math.atan2(Math.abs(y),Math.abs(x))*180/Math.PI;L=t.rotateTouch==="scroll-y"?M>45:90-M>45}L===!1&&(a.classList.add("atropos-rotate-touch"),e.cancelable&&e.preventDefault())}e.pointerType!=="mouse"&&L||H(l,v)}},D=function(e){if($=void 0,k=void 0,!!m.isActive&&!(e&&e.type==="pointerup"&&e.pointerType==="mouse")&&!(e&&e.type==="pointerleave"&&e.pointerType!=="mouse")){if(typeof t.rotateTouch=="string"&&L&&a.classList.remove("atropos-rotate-touch"),t.alwaysActive){H(),typeof t.onRotate=="function"&&t.onRotate(0,0),typeof t.onLeave=="function"&&t.onLeave();return}N.push(function(){return a.classList.remove("atropos-active")}),T(O,t.duration+"ms"),P(O,""),j(O,"translate3d(0,0, 0px)"),f&&(T(f,t.duration+"ms"),P(f,"")),d&&(T(d,t.duration+"ms"),P(d,""),j(d,"translate3d(0, 0, 0)"),s(d,0)),T(C,t.duration+"ms"),P(C,""),j(C,"translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"),q({duration:t.duration+"ms"}),m.isActive=!1,typeof t.onRotate=="function"&&t.onRotate(0,0),typeof t.onLeave=="function"&&t.onLeave()}},dt=function(e){var l=e.target;!r.contains(l)&&l!==r&&m.isActive&&D()},wt=function(){typeof a=="string"&&(a=U(document,a)),a&&(a.__atropos__||(typeof r<"u"?typeof r=="string"&&(r=U(document,r)):r=a,w=b?a.parentNode.host:a,Object.assign(m,{el:a}),C=U(a,".atropos-rotate"),O=U(a,".atropos-scale"),X=U(a,".atropos-inner"),a.__atropos__=m))},$t=function(){wt(),!(!a||!r)&&(t.shadow&&F(),t.highlight&&G(),t.rotateTouch&&(typeof t.rotateTouch=="string"?a.classList.add("atropos-rotate-touch-"+t.rotateTouch):a.classList.add("atropos-rotate-touch")),U(w,"[data-atropos-opacity]")&&q({opacityOnly:!0}),u(document,"click",dt),u(r,"pointerdown",J),u(r,"pointerenter",J),u(r,"pointermove",ft),u(r,"touchmove",ut),u(r,"pointerleave",D),u(r,"pointerup",D),u(r,"lostpointercapture",D),t.alwaysActive&&(lt(),H()))};return m.destroy=function(){m.destroyed=!0,cancelAnimationFrame(R),E(document,"click",dt),E(r,"pointerdown",J),E(r,"pointerenter",J),E(r,"pointermove",ft),E(r,"touchmove",ut),E(r,"pointerleave",D),E(r,"pointerup",D),E(r,"lostpointercapture",D),delete a.__atropos__},$t(),m}var ce=["component","children","rootChildren","scaleChildren","rotateChildren","className","scaleClassName","rotateClassName","innerClassName"];function at(){return at=Object.assign?Object.assign.bind():function(o){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(o[r]=a[r])}return o},at.apply(this,arguments)}function le(o,i){if(o==null)return{};var a={},r=Object.keys(o),b,w;for(w=0;w<r.length;w++)b=r[w],!(i.indexOf(b)>=0)&&(a[b]=o[b]);return a}var yt=["eventsEl","alwaysActive","activeOffset","shadowOffset","shadowScale","duration","rotate","rotateTouch","rotateXMax","rotateYMax","rotateXInvert","rotateYInvert","stretchX","stretchY","stretchZ","commonOrigin","shadow","highlight","onEnter","onLeave","onRotate"],ue=function(i){var a={};return Object.keys(i).forEach(function(r){yt.includes(r)||(a[r]=i[r])}),a},fe=function(i){var a={};return Object.keys(i).forEach(function(r){yt.includes(r)&&(a[r]=i[r])}),a};function de(o){var i=o.component,a=i===void 0?"div":i,r=o.children,b=o.rootChildren,w=o.scaleChildren,m=o.rotateChildren,t=o.className,C=t===void 0?"":t,O=o.scaleClassName,X=O===void 0?"":O,$=o.rotateClassName,k=$===void 0?"":$,f=o.innerClassName,d=f===void 0?"":f,L=le(o,ce),A=(0,h.useRef)(null),g=(0,h.useRef)(null),N=a,R=function(){for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];return c.filter(function(E){return!!E}).join(" ")},T=function(){g.current=ie(at({el:A.current},fe(o)))},P=function(){g.current&&(g.current.destroy(),g.current=null)};return(0,h.useEffect)(function(){return A.current&&T(),function(){P()}},[]),(0,h.useEffect)(function(){return g.current&&(g.current.params.onEnter=o.onEnter,g.current.params.onLeave=o.onLeave,g.current.params.onRotate=o.onRotate),function(){g.current&&(g.current.params.onEnter=null,g.current.params.onLeave=null,g.current.params.onRotate=null)}}),h.createElement(N,at({className:R("atropos",C)},ue(L),{ref:A}),h.createElement("span",{className:R("atropos-scale",X)},h.createElement("span",{className:R("atropos-rotate",k)},h.createElement("span",{className:R("atropos-inner",d)},r,(o.highlight||typeof o.highlight>"u")&&h.createElement("span",{className:"atropos-highlight"})),m,(o.shadow||typeof o.shadow>"u")&&h.createElement("span",{className:"atropos-shadow"})),w),b)}var pe=de,n=xt(Ut());function we(){const[o,i]=(0,h.useState)(!1),[a,r]=(0,h.useState)(""),[,b]=(0,h.useState)(""),[w,m]=(0,h.useState)("http"),[t,C]=(0,h.useState)(""),[O,X]=(0,h.useState)(""),[$,k]=(0,h.useState)(!1),[f,d]=(0,h.useState)(!1),L=qt(),A=()=>{const{protocol:s,hostname:c,port:u}=window.location;return u==="5173"?`${s}//${c}:7777`:u?`${s}//${c}:${u}`:`${s}//${c}`},g=s=>{try{const c=new URL(s);m(c.protocol==="https:"?"https":"http"),C(c.hostname),X(c.port||(c.protocol==="https:"?"443":"7777"))}catch{m("http"),C("localhost"),X("7777")}},N=(0,h.useCallback)(()=>t?`${w}://${t}:${O||(w==="https"?"443":"7777")}`:"",[w,t,O]);(0,h.useEffect)(()=>{if(Q()){const s=localStorage.getItem("serverUrl");if(s)b(s),g(s),Zt(async()=>{const{invoke:c}=await import("./core-CO0KNPJl.js");return{invoke:c}},__vite__mapDeps([0,1,2])).then(({invoke:c})=>{c("set_server_url",{url:s}).catch(console.error)});else{const c=A();b(c),g(c)}}},[]),(0,h.useEffect)(()=>{Q()&&t&&b(N())},[w,t,O,N]);const R=async()=>{if(!Q())return!0;if(!t.trim())return I.error("请输入服务器地址"),!1;const s=N();if(!s)return I.error("请输入服务器地址"),!1;try{new URL(s)}catch{return I.error("请输入有效的服务器地址"),!1}d(!0);try{return await Dt("set_server_url",{url:s}),(await gt.serverGet("/api/v1/ping",{timeout:5e3})).ping==="pong"?(localStorage.setItem("serverUrl",s),b(s),I.success("服务器连接成功"),!0):(I.error("无法连接到服务器，请检查地址是否正确"),!1)}catch{return I.error("连接测试失败，请检查服务器地址"),!1}finally{d(!1)}},T=async()=>{await R()},P=async()=>{if(!a.trim()){I.error("请输入密钥");return}if(await R()){k(!0);try{const s=Gt(a),c=await gt.serverPost("/api/v1/login",{authorization:s});if(!c||c===null){I.error("登录失败，密钥错误！");return}localStorage.setItem(nt.userId,c.userId),localStorage.setItem(nt.accessToken,c.accessToken),localStorage.setItem(nt.refreshToken,c.refreshToken),I.success("登录成功！");const u=localStorage.getItem("redirectPath");localStorage.removeItem("redirectPath"),u&&u!=="/kkk/login"?window.location.href=u:L("/crack",{replace:!0})}catch(s){console.error(s),I.error("登录失败，请检查密钥是否正确")}finally{k(!1)}}},j=s=>{s.stopPropagation();const c=s.currentTarget;setTimeout(()=>{c.focus()},0)};return(0,n.jsx)("div",{className:"flex justify-center items-center p-4 min-h-screen bg-background",children:(0,n.jsx)(pe,{className:"w-full max-w-lg pointer-events-none",activeOffset:40,shadowScale:1.05,rotateXMax:15,rotateYMax:15,duration:300,shadow:!0,children:(0,n.jsxs)(zt,{className:"w-full h-full","data-atropos-offset":"0",children:[(0,n.jsxs)(Ft,{className:"space-y-1","data-atropos-offset":"0",children:[(0,n.jsx)(Ht,{className:"text-2xl font-semibold tracking-tight",children:"kkk 插件登录"}),(0,n.jsx)(Bt,{children:Q()?"请先配置服务器地址，然后输入密钥登录":"请输入密钥登录"})]}),(0,n.jsx)(Kt,{"data-atropos-offset":"0",children:(0,n.jsxs)("form",{className:"space-y-4 pointer-events-auto",onSubmit:s=>{s.preventDefault(),P()},children:[Q()&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(et,{htmlFor:"serverConfig",children:"服务器地址"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 pointer-events-auto z-10","data-atropos-offset":"0",children:[(0,n.jsx)(et,{htmlFor:"protocol",className:"text-sm text-muted-foreground min-w-[40px]",children:"协议"}),(0,n.jsxs)(Yt,{value:w,onValueChange:s=>m(s),children:[(0,n.jsx)(Rt,{className:"w-[100px]","data-atropos-offset":"0",children:(0,n.jsx)(Lt,{})}),(0,n.jsxs)(It,{"data-atropos-offset":"0",children:[(0,n.jsx)(vt,{value:"http",children:"HTTP"}),(0,n.jsx)(vt,{value:"https",children:"HTTPS"})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 pointer-events-auto z-10","data-atropos-offset":"0",children:[(0,n.jsx)(et,{htmlFor:"hostname",className:"text-sm text-muted-foreground min-w-[40px]",children:"地址"}),(0,n.jsxs)("div",{className:"relative flex-1 pointer-events-auto z-10","data-atropos-offset":"0",children:[(0,n.jsx)(Xt,{className:"absolute left-3 top-1/2 w-4 h-4 transform -translate-y-1/2 text-muted-foreground","data-atropos-offset":"0"}),(0,n.jsx)(st,{id:"hostname",type:"text",value:t,onChange:s=>{const c=s.target.value;if(c.includes("://")){const u=c.match(/(https?:\/\/[^\s]+)/);if(u){const E=u[1],F=new URL(E),G=F.protocol==="https:"?"https":"http",q=F.hostname,H=F.port||(G==="https"?"443":"7777");m(G),C(q),X(H);return}}C(c)},className:"pl-9",placeholder:"localhost 或粘贴完整URL",disabled:$||f,onTouchStart:j,"data-atropos-offset":"0"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-1 pointer-events-auto z-10","data-atropos-offset":"0",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:":"}),(0,n.jsx)(st,{id:"port",type:"number",value:O,onChange:s=>X(s.target.value),className:"w-[80px]",placeholder:w==="https"?"443":"7777",disabled:$||f,onTouchStart:j,min:"1",max:"65535","data-atropos-offset":"0"})]})]}),t&&(0,n.jsxs)("div",{className:"p-2 text-xs rounded border text-muted-foreground bg-muted/50 pointer-events-auto z-10","data-atropos-offset":"0",children:["地址预览: ",N()]})]}),(0,n.jsx)(mt,{type:"button",variant:"outline",onClick:T,disabled:f||!t.trim(),className:"w-full relative z-10 pointer-events-auto","data-atropos-offset":"0",children:f?"测试连接中...":"测试服务器连接"})]}),(0,n.jsx)(Qt,{"data-atropos-offset":"0"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(et,{htmlFor:"token",children:"密钥"}),(0,n.jsxs)("div",{className:"relative z-10 pointer-events-auto","data-atropos-offset":"0",children:[(0,n.jsx)(re,{className:"absolute left-3 top-1/2 w-4 h-4 transform -translate-y-1/2 text-muted-foreground","data-atropos-offset":"0"}),(0,n.jsx)(st,{id:"token",type:o?"text":"password",value:a,onChange:s=>r(s.target.value),className:"pr-9 pl-9",placeholder:"请输入 HTTP 鉴权密钥",disabled:$,onTouchStart:j,"data-atropos-offset":"0"}),(0,n.jsx)("button",{type:"button",onClick:()=>i(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground pointer-events-auto",disabled:$||f,"data-atropos-offset":"0",children:o?(0,n.jsx)(ee,{className:"w-4 h-4"}):(0,n.jsx)(At,{className:"w-4 h-4"})})]})]}),(0,n.jsxs)(mt,{type:"submit",disabled:$,className:"relative z-10 pointer-events-auto w-full","data-atropos-offset":"0",children:[$?"登录中...":"登录",!$&&(0,n.jsx)(Wt,{className:"ml-2 w-4 h-4","data-atropos-offset":"0"})]})]})})]})})})}export{we as default};
