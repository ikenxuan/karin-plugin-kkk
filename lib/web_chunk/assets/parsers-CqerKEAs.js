import{J as T,L as x,V as $,ct as f,g as E,rt as M,x as D}from"./index-CUMWXq9f.js";import{t as c}from"./request-D5Tnl0Bp.js";var C=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Q=T("video",C),w=f(M()),I=f($()),R=E("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function X({className:r,variant:t,asChild:e=!1,...i}){return(0,I.jsx)(e?x:"span",{"data-slot":"badge",className:D(R({variant:t}),r),...i})}var g=768;const ee=()=>{const[r,t]=w.useState(void 0);return w.useEffect(()=>{const e=window.matchMedia(`(max-width: ${g-1}px)`),i=()=>{t(window.innerWidth<g)};return e.addEventListener("change",i),t(window.innerWidth<g),()=>e.removeEventListener("change",i)},[]),!!r},m=r=>{if(r<0)return"0:00";const t=Math.floor(r),e=Math.floor(t/60),i=t%60;return e>=60?`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${e}:${i.toString().padStart(2,"0")}`},u=r=>r>=1e4?(r/1e4).toFixed(1)+"w":r>=1e3?(r/1e3).toFixed(1)+"k":r.toString(),_=r=>{const t=Math.floor(Date.now()/1e3)-r;return t<60?"刚刚":t<3600?`${Math.floor(t/60)}分钟前`:t<86400?`${Math.floor(t/3600)}小时前`:t<2592e3?`${Math.floor(t/86400)}天前`:new Date(r*1e3).toLocaleDateString("zh-CN")},j=r=>{for(const e of[/https?:\/\/(?:[^\s]*\.)?(?:douyin\.com|iesdouyin\.com|webcast\.amemv\.com|live\.douyin\.com)(?:\/[^\s\u4e00-\u9fff]*)*/gi,/(https?:\/\/(?:www\.bilibili\.com|m\.bilibili\.com|t\.bilibili\.com|b23\.tv|bili2233\.cn)\/[a-zA-Z0-9_\-.~:\\/?#[\]@!$&'()*+,;=]+)/gi,/https?:\/\/(?:[^\s]*\.)?(?:kuaishou\.com|kwai\.com|chenzhongtech\.com)(?:\/[^\s\u4e00-\u9fff]*)*/gi]){const i=r.match(e);if(i&&i.length>0){let a=i[0];return a=a.replace(/[，。！？；：、"'`]+$/,""),a}}const t=r.match(/https?:\/\/[^\s\u4e00-\u9fff]+/gi);if(t&&t.length>0){let e=t[0];return e=e.replace(/[，。！？；：、"'`]+$/,""),e}return null},A=r=>{const t=r.match(/\/video\/(BV[a-zA-Z0-9]+)/),e=r.match(/\/video\/av(\d+)/),i=r.match(/^https:\/\/t\.bilibili\.com\/(\d+)/),a=r.match(/^https:\/\/www\.bilibili\.com\/opus\/(\d+)/);let s=null,o="";switch(t?(s=t,o="bvid"):e?(s=e,o="aid"):i?(s=i,o="dynamic"):a&&(s=a,o="dynamic"),o){case"bvid":return{platform:"bilibili",workId:s?.[1]??"",workType:"video",params:{bvid:s?.[1]??""}};case"aid":return{platform:"bilibili",workId:s?.[1]??"",workType:"video",params:{aid:s?.[1]??""}};case"dynamic":return{platform:"bilibili",workId:s?.[1]??"",workType:"dynamic_info",params:{dynamic_id:s?.[1]??""}};default:break}throw new Error("无法从URL中提取哔哩哔哩作品ID")},P=async r=>{try{if(r.workType==="dynamic_info")return await S(r);const t=await c.serverPost("/api/kkk/bilibili/data",{dataType:"单个视频作品数据",params:r.params}),e=await c.serverPost("/api/kkk/bilibili/data",{dataType:"单个视频下载信息数据",params:{avid:t.data.data.aid,cid:t.data.data.cid}}),i=t.data.data,a=await c.serverPost("/api/kkk/bilibili/data",{dataType:"评论数据",params:{oid:i.aid.toString(),type:1,number:50}}),s=await c.serverPost("/api/kkk/bilibili/data",{dataType:"Emoji数据",params:{}}),o=a.data.data,d=s.data,l=k(o.replies||[],d);return{id:i.bvid,title:i.title||"无标题",description:i.desc||"",thumbnail:i.pic||"",duration:m(i.duration||0),views:u(i.stat?.view||0),likes:u(i.stat?.like||0),author:i.owner?.name||"未知用户",type:"video",downloadUrl:{video:e.data.data.dash.video[0].baseUrl||"获取失败",audio:e.data.data.dash.audio[0].baseUrl||"获取失败"},images:void 0,tags:i.tname?[i.tname]:[],comments:l,commentCount:i.stat?.reply||0}}catch(t){throw new Error(`哔哩哔哩数据解析失败: ${t.message}`)}};var S=async r=>{try{const t=await c.serverPost("/api/kkk/bilibili/data",{dataType:"动态详情数据",params:{dynamic_id:r.params.dynamic_id,typeMode:"strict"}}),e=await c.serverPost("/api/kkk/bilibili/data",{dataType:"动态卡片数据",params:{dynamic_id:t.data.data.item.id_str,typeMode:"strict"}}),i=t.data.data,a=e.data.data;let s=[],o=0;if(i.item.type!=="LIVE_RCMD")try{const l=await c.serverPost("/api/kkk/bilibili/data",{dataType:"评论数据",params:{type:V(i.item.type),oid:L(i,a),number:50}}),p=await c.serverPost("/api/kkk/bilibili/data",{dataType:"Emoji数据",params:{}}),y=l.data.data,h=p.data;s=k(y.replies||[],h),o=i.item.modules?.module_stat?.comment?.count||0}catch(l){console.warn("获取动态评论失败:",l)}const d=Y(i);return{id:i.item.id_str,title:d.title||`${i.item.modules.module_author.name}的动态`,description:d.description||"",thumbnail:d.thumbnail||i.item.modules.module_author.face,duration:"0:00",views:u(i.item.modules?.module_stat?.view?.count||0),likes:u(i.item.modules?.module_stat?.like?.count||0),author:i.item.modules.module_author.name||"未知用户",type:d.type,downloadUrl:void 0,images:d.images,tags:[],comments:s,commentCount:o}}catch(t){throw new Error(`哔哩哔哩动态解析失败: ${t.message}`)}},Y=r=>{const t=r.item;switch(t.type){case"DYNAMIC_TYPE_DRAW":return{title:"图文动态",description:t.modules.module_dynamic?.desc?.text||"",thumbnail:t.modules.module_dynamic?.major?.draw?.items?.[0]?.src||"",images:t.modules.module_dynamic?.major?.draw?.items?.map(e=>e.src)||[],type:"note"};case"DYNAMIC_TYPE_WORD":return{title:"文字动态",description:t.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"};case"DYNAMIC_TYPE_AV":return{title:t.modules.module_dynamic?.major?.archive?.title||"视频动态",description:t.modules.module_dynamic?.major?.archive?.desc||"",thumbnail:t.modules.module_dynamic?.major?.archive?.cover||"",images:[],type:"video"};case"DYNAMIC_TYPE_FORWARD":return{title:"转发动态",description:t.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"};default:return{title:"动态内容",description:t.modules.module_dynamic?.desc?.text||"",thumbnail:"",images:[],type:"note"}}},V=r=>{switch(r){case"DYNAMIC_TYPE_AV":return 1;case"DYNAMIC_TYPE_DRAW":case"DYNAMIC_TYPE_WORD":case"DYNAMIC_TYPE_FORWARD":return 17;default:return 17}},L=(r,t)=>{const e=r.item;switch(e.type){case"DYNAMIC_TYPE_AV":return e.modules.module_dynamic?.major?.archive?.aid?.toString()||e.id_str;case"DYNAMIC_TYPE_WORD":case"DYNAMIC_TYPE_FORWARD":return e.id_str;default:return t.card.desc.rid.toString()}},k=(r,t)=>!r||!Array.isArray(r)?[]:r.map((e,i)=>{let a=e.content?.message||"";return t&&a&&(a=N(a,t)),{id:e.rpid?.toString()||i.toString(),author:e.member?.uname||"匿名用户",avatar:e.member?.avatar||"",content:a,images:e.content?.pictures?e.content.pictures.map(s=>s.img_src):[],likes:e.like||0,timestamp:_(e.ctime||0)}}),N=(r,t)=>{if(!r||!t?.data?.packages)return r;let e=r;const i=new Map;return t.data.packages.forEach(a=>{a.emote.forEach(s=>{i.set(s.text,s.url)})}),e=e.replace(/\[([^\]]+)\]/g,(a,s)=>{const o=i.get(a)||i.get(s);return o?`<img src="${o}" alt="${s}" class="emoji" />`:a}),e.split(/(<img[^>]*>)/).map(a=>a.startsWith("<img")?a:a.trim()?`<span>${a}</span>`:a).join("")};const W=r=>{const t=/video\/(\d+)/.exec(r),e=/note\/(\d+)/.exec(r),i=/modal_id=(\d+)/.exec(r);switch(!0){case/video\/(\d+)/.test(r):return{platform:"douyin",workId:t?t[1]:"",workType:"video",params:{aweme_id:t?t[1]:""}};case/note\/(\d+)/.test(r):return{platform:"douyin",workId:e?e[1]:"",workType:"video",params:{aweme_id:e?e[1]:""}};case/modal_id=(\d+)/.test(r):return{platform:"douyin",workId:i?i[1]:"",workType:"video",params:{aweme_id:i?i[1]:""}};default:throw new Error("无法从URL中提取抖音作品ID")}};var B=(r,t)=>{if(!r||!t||t.length===0)return r;let e=r;return t.forEach(i=>{if(i){const a=new RegExp(`#${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?:\\s|$)`,"gi");e=e.replace(a,"");const s=new RegExp(`@${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?:\\s|$)`,"gi");e=e.replace(s,"");const o=new RegExp(`\\b${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");e=e.replace(o,"")}}),e.replace(/\s+/g," ").trim()};const O=async r=>{try{const t=await c.serverPost("/api/kkk/douyin/data",{dataType:"聚合解析",params:r.params}),e=await c.serverPost("/api/kkk/douyin/data",{dataType:"评论数据",params:r.params}),i=await c.serverPost("/api/kkk/douyin/data",{dataType:"Emoji数据",params:{}}),a=t.data.aweme_detail,s=e.data.comments,o=i.data,d=a.is_slides===!0&&a.images!==null,l=!a.images&&!d,p=d?"slides":l?"video":"note",y=U(s,o),h=Array.isArray(a.text_extra)?a.text_extra.map(n=>typeof n=="string"?n:n.hashtag_name).filter(Boolean):[],b=B(a.desc||"无标题",h);let v;return d&&a.images&&(v=a.images.map(n=>n.clip_type===2?{type:"image",url:n.url_list[2],thumbnail:n.url_list[2]}:n.clip_type===3?{type:"livephoto",url:n.url_list[2],videoUrl:n.video.play_addr_h264.url_list[0],thumbnail:n.url_list[2],duration:m(n.video?.duration/1e3||0)}:{type:"video",url:n.video.play_addr_h264.url_list[0],thumbnail:n.url_list[2],duration:m(n.video?.duration/1e3||0)})),{id:`${a.aweme_id}_${Date.now()}`,title:b,description:a.desc||"",thumbnail:l?a.video?.cover?.url_list?.[0]:a.images?.[0]?.url_list?.[0]||"",duration:l?m(a.video?.duration/1e3||0):"0:00",views:u(a.statistics?.play_count||0),likes:u(a.statistics?.digg_count||0),author:a.author?.nickname||"未知用户",type:p,downloadUrl:{video:l?a.video?.play_addr?.url_list?.[0]||"获取失败":d&&v&&v.find(n=>n.type==="video")?.url||void 0,audio:d&&a.video?a.video?.play_addr?.url_list?.[0]||"获取失败":a.music?.play_url?.uri||"获取失败"},images:p==="note"?a.images?.map(n=>n.url_list?.[2]).filter(Boolean):void 0,slides:v,tags:h,comments:y,commentCount:a.statistics?.comment_count||0}}catch(t){throw new Error(`抖音数据解析失败: ${t.message}`)}};var U=(r,t)=>!r||!Array.isArray(r)?[]:r.map((e,i)=>{let a=e.text||"";return t&&e.text&&(a=z(e.text,t)),{id:`${e.cid||i.toString()}_${Date.now()}`,author:e.user?.nickname||"匿名用户",avatar:e.user?.avatar_thumb?.url_list?.[0]||"",content:a,images:e.image_list?e.image_list.map(s=>s.origin_url?.url_list?.[3]).filter(Boolean):[],likes:e.digg_count||0,timestamp:_(e.create_time||0)}}),z=(r,t)=>{if(!r||!t?.emoji_list)return r;let e=r;return e=e.replace(/\[([^\]]+)\]/g,(i,a)=>{const s=t.emoji_list.find(o=>o.display_name===`[${a}]`);return s&&s.emoji_url?.url_list?.[0]?`<img src="${s.emoji_url.url_list[0]}" alt="${a}" class="emoji" />`:i}),e.split(/(<img[^>]*>)/).map(i=>i.startsWith("<img")?i:i.trim()?`<span>${i}</span>`:i).join("")};const F=r=>{const t=r.match(/\/short-video\/(\w+)/);if(!t)throw new Error("无法从URL中提取快手作品ID");const e=t[1];return{platform:"kuaishou",workId:e,workType:"video",params:{photoId:e}}},K=async r=>{try{const t=await c.post("/api/kkk/kuaishou/data",{dataType:"单个作品数据",params:r.params}),e=await c.post("/api/kkk/kuaishou/data",{dataType:"评论数据",params:r.params}),i=await c.post("/api/kkk/kuaishou/data",{dataType:"Emoji数据",params:{}}),a=t.data.data.photo,s=e.data.data,o=i.data.data,d=q(s.rootComments||[],o);return{id:a.photoId||r.workId,title:a.caption||"无标题",description:a.caption||"暂无描述",thumbnail:a.coverUrl||"",duration:m(a.duration||0),views:u(a.viewCount||0),likes:u(a.likeCount||0),author:a.userName||"未知用户",type:"video",downloadUrl:{video:a.mainMvUrls?.[0]?.url||"",audio:a.mainMvUrls?.[0]?.url||""},images:void 0,tags:a.tags?.map(l=>l.name).filter(Boolean)||[],comments:d.slice(0,20),commentCount:a.commentCount||0}}catch(t){throw new Error(`快手数据解析失败: ${t.message}`)}};var q=(r,t)=>!r||!Array.isArray(r)?[]:r.map((e,i)=>{let a=e.content||"";return t&&e.content&&(a=Z(e.content,t)),{id:e.commentId||i.toString(),author:e.authorName||"匿名用户",avatar:e.headUrl||"",content:a,images:[],likes:e.likedCount||0,timestamp:_(e.timestamp||0)}}),Z=(r,t)=>{let e=r;return t&&t.emoji_list&&t.emoji_list.forEach(i=>{const a=new RegExp(`\\[${i.name}\\]`,"g"),s=`<img src="${i.url}" alt="${i.name}" class="emoji" />`;e=e.replace(a,s)}),e},J=class{async parseVideo(r){const t=j(r);if(!t)throw new Error("未能从输入文本中提取到有效的视频链接");const{finalUrl:e,platform:i}=await c.serverPost("/api/kkk/getLongLink",{link:t});let a;switch(i){case"douyin":a=W(e);break;case"bilibili":a=A(e);break;case"kuaishou":a=F(e);break;default:throw new Error(`不支持的平台: ${i}`)}let s;switch(i){case"douyin":s=await O(a);break;case"bilibili":s=await P(a);break;case"kuaishou":s=await K(a);break;default:throw new Error(`不支持的平台: ${i}`)}return s}};const te=new J;export{Q as a,X as i,j as n,ee as r,te as t};
