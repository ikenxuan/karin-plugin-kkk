import{r as d,u as f,j as e,t as h}from"./index-CSYHYaUf.js";import{c as u,C as x,a as y,b as g,d as w,e as j,I as k,B as N,r as b,k as m}from"./request-wY3O-LDL.js";import{L as v}from"./label-Dxbjz2PX.js";import{E as S}from"./eye-CxPAm1zo.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],I=u("arrow-right",C);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],L=u("eye-off",T);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],A=u("lock",E),H=async r=>{try{const s=new TextEncoder().encode(r),o=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch{if(typeof sha256!="function"){const s=document.createElement("script");s.src="/web/sha256.min.js",await new Promise((o,t)=>{s.onload=o,s.onerror=t,document.head.appendChild(s)})}return sha256(r)}};function B(){const[r,n]=d.useState(!1),[s,o]=d.useState(""),[t,c]=d.useState(!1),i=f(),p=async()=>{if(!s.trim()){h.error("请输入密钥");return}c(!0);try{const a=await H(s),l=await b.serverPost("/api/v1/login",{authorization:a});localStorage.setItem(m.userId,l.userId),localStorage.setItem(m.accessToken,l.accessToken),localStorage.setItem(m.refreshToken,l.refreshToken),h.success("登录成功"),i("/",{replace:!0})}catch(a){console.error(a),h.error(`登录失败: ${a.message}`)}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs(x,{className:"w-full max-w-md",children:[e.jsxs(y,{className:"space-y-1",children:[e.jsx(g,{className:"text-2xl font-semibold tracking-tight",children:"登录"}),e.jsx(w,{children:"欢迎回来，请输入密钥继续"})]}),e.jsx(j,{children:e.jsxs("form",{className:"space-y-4",onSubmit:a=>{a.preventDefault(),p()},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"token",children:"密钥"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"token",type:r?"text":"password",value:s,onChange:a=>o(a.target.value),className:"pl-9 pr-9",placeholder:"请输入 HTTP 鉴权密钥",disabled:t}),e.jsx("button",{type:"button",onClick:()=>n(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",disabled:t,children:r?e.jsx(L,{className:"h-4 w-4"}):e.jsx(S,{className:"h-4 w-4"})})]})]}),e.jsxs(N,{type:"submit",disabled:t,className:"w-full",children:[t?"登录中...":"登录",!t&&e.jsx(I,{className:"ml-2 h-4 w-4"})]})]})})]})})}export{B as default};
