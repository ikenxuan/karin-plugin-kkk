---
title: 功能详解
icon: star
order: 2
---

# 功能详解

本文档详细介绍 karin-plugin-kkk 的各项功能特性。

## 平台功能对比

### 抖音（Douyin）

| 功能 | 支持状态 | 说明 |
|-----|---------|------|
| 视频解析 | ✅ | 支持单视频、合辑视频解析 |
| 图集解析 | ✅ | 支持多图作品解析 |
| 直播解析 | ✅ | 获取直播间信息 |
| 评论解析 | ✅ | 可配置评论数量（1-30条） |
| 动态推送 | ✅ | 定时监控创作者动态 |
| 扫码登录 | ✅ | APP 扫码获取 Cookies |
| 画质选择 | ✅ | 支持 540p/720p/1080p/2k/4k 或自适应 |
| 体积控制 | ✅ | 可设置最大视频体积，超出则不发送 |
| 信息展示 | ✅ | 支持文本或图片模式 |
| 自定义显示 | ✅ | 可选择显示封面/标题/作者/统计数据 |

**推送功能配置项：**
- 权限控制：all/admin/master/group.owner/group.admin
- Cron 表达式：自定义推送时间间隔
- 动态解析：自动解析推送的动态内容
- 分享类型：视频/图集/直播/评论
- 画质偏好：独立于解析功能的推送画质设置
- 日志记录：记录推送历史到数据库

### B站（Bilibili）

| 功能 | 支持状态 | 说明 |
|-----|---------|------|
| 视频解析 | ✅ | 支持普通视频、分P视频 |
| 动态解析 | ✅ | 支持图文动态、转发动态 |
| 番剧解析 | ✅ | 支持番剧信息获取 |
| 直播解析 | ✅ | 获取直播间信息 |
| 评论解析 | ✅ | 可配置评论数量，支持真实/解析数量显示 |
| 动态推送 | ✅ | 定时监控 UP 主动态 |
| 扫码登录 | ✅ | APP 扫码获取 Cookies |
| 画质选择 | ✅ | 支持 240P-8k 多档画质或自动选择 |
| 体积控制 | ✅ | 可设置最大视频体积 |
| 图片布局 | ✅ | 支持垂直/瀑布流/网格/自动布局 |
| 信息展示 | ✅ | 支持文本或图片模式 |
| 自定义显示 | ✅ | 可选择显示封面/标题/作者/统计/简介 |

**推送功能配置项：**
- 权限控制：all/admin/master/group.owner/group.admin
- Cron 表达式：自定义推送时间间隔
- 动态解析：自动解析推送的动态内容
- 画质偏好：独立的推送画质设置
- 日志记录：记录推送历史到数据库

### 快手（Kuaishou）

| 功能 | 支持状态 | 说明 |
|-----|---------|------|
| 视频解析 | ✅ | 支持作品视频解析 |
| 评论解析 | ✅ | 可配置评论数量（1-10条） |
| 动态推送 | ❌ | 暂不支持 |
| 扫码登录 | ❌ | 需手动配置 Cookies |
| 画质选择 | ✅ | 自动获取最佳画质 |

### 小红书（Xiaohongshu）

| 功能 | 支持状态 | 说明 |
|-----|---------|------|
| 图文笔记 | ✅ | 支持多图笔记解析 |
| 视频笔记 | ✅ | 支持视频笔记解析 |
| 评论解析 | ✅ | 可配置评论数量 |
| 动态推送 | ❌ | 暂不支持 |
| 扫码登录 | ❌ | 需手动配置 Cookies |
| 画质选择 | ✅ | 支持 540p/720p/1080p/2k/4k 或自适应 |
| 体积控制 | ✅ | 可设置最大视频体积 |

## 解析功能详解

### 内容解析流程

1. **链接识别**：自动识别消息中的平台分享链接
2. **数据提取**：调用 @ikenxuan/amagi 统一 API 获取内容数据
3. **内容处理**：根据配置决定发送信息/评论/视频
4. **渲染输出**：使用 渲染器 渲染 html 成图片或直接发送视频文件

### 解析配置项

| 配置项 | 适用平台 | 说明 |
|-------|---------|------|
| `switch` | 全部 | 平台解析总开关 |
| `tip` | 全部 | 是否发送"检测到链接，开始解析"提示 |
| `sendContent` | 抖音/B站/小红书 | 发送内容类型：info/comment/video/image |
| `numcomment` | 全部 | 评论数量配置 |
| `realCommentCount` | 抖音/B站 | 显示真实评论数还是解析到的数量 |
| `videoQuality` | 抖音/B站/小红书 | 视频画质偏好 |
| `maxAutoVideoSize` | 抖音/B站/小红书 | 最大视频体积（MB） |
| `videoInfoMode` | 抖音/B站 | 信息展示模式：text/image |
| `displayContent` | 抖音/B站 | 自定义显示内容项 |
| `imageLayout` | B站 | 图片布局方式 |

### 视频处理策略

**画质自适应逻辑：**
1. 从最高画质开始尝试下载
2. 检查文件大小是否超过 `maxAutoVideoSize`
3. 超出则降级到下一档画质
4. 重复直到找到合适画质或达到最低画质

**固定画质模式：**
- 直接下载指定画质
- 不进行体积检查
- 适合对画质有明确要求的场景

## 推送功能详解

### 推送系统架构

```
定时任务调度器 (Cron)
    ↓
检查订阅列表 (pushlist.yaml)
    ↓
获取最新动态 (API)
    ↓
对比数据库记录 (SQLite)
    ↓
过滤策略判断 (黑白名单/关键词/标签)
    ↓
内容解析 (可选)
    ↓
推送到群聊
    ↓
记录推送历史
```

### 推送配置详解

| 配置项 | 说明 | 可选值 |
|-------|------|--------|
| `switch` | 推送总开关 | true/false |
| `permission` | 订阅权限 | all/admin/master/group.owner/group.admin |
| `cron` | 推送时间表达式 | Cron 表达式，如 `*/10 * * * *` |
| `parsedynamic` | 是否解析动态内容 | true/false |
| `log` | 是否记录推送日志 | true/false |
| `shareType` | 推送内容类型（抖音） | video/image/live/comment |
| `videoQuality` | 推送视频画质 | 同解析画质选项 |
| `maxAutoVideoSize` | 推送视频体积限制 | 数字（MB） |

### 订阅管理

**抖音订阅格式：**
```yaml
douyin:
  - switch: true
    short_id: "yuanshen_mihoyo"  # 抖音号（二选一）
    sec_uid: "MS4wLjABAAAA..."    # sec_uid（二选一）
    group_id:
      - "群号1:机器人账号1"
      - "群号2:机器人账号2"
    remark: "原神官方"  # 备注（可选）
```

**B站订阅格式：**
```yaml
bilibili:
  - switch: true
    host_mid: 401742377  # UP主UID（必填）
    group_id:
      - "群号1:机器人账号1"
      - "群号2:机器人账号2"
    remark: "某UP主"  # 备注（可选）
```

### 推送命令

| 命令 | 功能 | 权限 |
|-----|------|------|
| `#抖音推送列表` | 查看当前群订阅 | 群成员 |
| `#B站推送列表` | 查看当前群订阅 | 群成员 |
| `#设置抖音推送 + 抖音号` | 订阅/取消订阅 | 配置的权限 |
| `#设置B站推送 + UID` | 订阅/取消订阅 | 配置的权限 |
| `#抖音强制推送` | 当前群立即推送一次 | 管理员 |
| `#B站强制推送` | 当前群立即推送一次 | 管理员 |
| `#抖音全部强制推送` | 所有群立即推送一次 | Master |
| `#B站全部强制推送` | 所有群立即推送一次 | Master |
| `#kkk设置推送机器人 + Bot ID` | 更换推送机器人 | 管理员 |

## 其他功能

### 缓存管理

- 自动清理下载缓存（可配置 `removeCache`）
- 视频文件下载后自动删除
- 临时文件定期清理

### 日志系统

- 详细的操作日志
- 错误日志可配置接收人
- 推送历史记录到数据库

### 表情反馈

```yaml
app:
  EmojiReply: true           # 启用表情反馈
  EmojiReplyID: "123"        # 自定义表情ID
```

解析成功后自动添加表情反应。

### 代理支持

```yaml
request:
  proxy:
    switch: true
    host: "127.0.0.1"
    port: "7890"
    protocol: "http"  # http/https
    auth:
      username: ""
      password: ""
```

解析库支持 HTTP/HTTPS 代理，可配置认证信息。
